{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable max-len */\nimport { isNullOrUndefined, extend, removeClass } from '@syncfusion/ej2-base';\nimport { getRecurrenceStringFromDate, generate } from '../../recurrence-editor/date-generator';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\n/**\n * Schedule CRUD operations\n */\nvar Crud = /** @class */function () {\n  function Crud(parent) {\n    this.parent = parent;\n    this.crudObj = {\n      sourceEvent: null,\n      targetEvent: null,\n      isCrudAction: false\n    };\n  }\n  Crud.prototype.getQuery = function () {\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    return this.parent.dataModule.generateQuery(start, end);\n  };\n  Crud.prototype.getTable = function () {\n    if (this.parent.eventSettings.query) {\n      var query = this.parent.eventSettings.query.clone();\n      return query.fromTable;\n    }\n    return null;\n  };\n  Crud.prototype.refreshDataManager = function () {\n    var _this = this;\n    if (!this.parent.activeView) {\n      return;\n    }\n    if (this.parent.uiStateValues && this.parent.uiStateValues.isPreventEventRefresh) {\n      this.parent.uiStateValues.isPreventEventRefresh = false;\n      this.parent.refreshEvents(false);\n      this.parent.hideSpinner();\n      return;\n    }\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    var dataManager = this.parent.dataModule.getData(this.parent.dataModule.generateQuery(start, end));\n    dataManager.then(function (e) {\n      return _this.dataManagerSuccess(e);\n    }).catch(function (e) {\n      return _this.dataManagerFailure(e);\n    });\n  };\n  Crud.prototype.dataManagerSuccess = function (e) {\n    var _this = this;\n    if (!this.parent || this.parent && this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.trigger(events.dataBinding, e, function (args) {\n      if (args.cancel) {\n        return;\n      }\n      var resultData = extend([], args.result, null, true);\n      _this.parent.eventsData = resultData.filter(function (data) {\n        return !data[_this.parent.eventFields.isBlock];\n      });\n      _this.parent.blockData = resultData.filter(function (data) {\n        return data[_this.parent.eventFields.isBlock];\n      });\n      _this.refreshProcessedData();\n      if (_this.parent.dragAndDropModule && _this.parent.dragAndDropModule.actionObj.action === 'drag') {\n        _this.parent.dragAndDropModule.navigationWrapper();\n      }\n      _this.parent.trigger(events.dataBound, null, function () {\n        _this.parent.hideSpinner();\n        if (_this.parent.isPrinting) {\n          setTimeout(function () {\n            _this.parent.notify(events.print, {});\n          }, 100);\n        }\n      });\n    });\n  };\n  Crud.prototype.dataManagerFailure = function (e) {\n    var _this = this;\n    if (!this.parent || this.parent && this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.trigger(events.actionFailure, {\n      error: e\n    }, function () {\n      return _this.parent.hideSpinner();\n    });\n  };\n  Crud.prototype.refreshProcessedData = function (isVirtualScrollAction, dynamicEvents) {\n    if (isVirtualScrollAction === void 0) {\n      isVirtualScrollAction = false;\n    }\n    if (this.parent.dragAndDropModule) {\n      this.parent.dragAndDropModule.actionObj.action = '';\n      removeClass([this.parent.element], 'e-event-action');\n    }\n    if (this.parent.activeViewOptions && this.parent.activeViewOptions.eventTemplate) {\n      var templateNames = ['eventTemplate'];\n      if (this.crudObj.isCrudAction && ['Agenda', 'MonthAgenda', 'Year', 'TimelineYear'].indexOf(this.parent.currentView) === -1) {\n        templateNames = [];\n        for (var i = 0, len = this.crudObj.sourceEvent.length; i < len; i++) {\n          templateNames.push('eventTemplate_' + this.crudObj.sourceEvent[parseInt(i.toString(), 10)].groupIndex);\n          if (this.crudObj.targetEvent[parseInt(i.toString(), 10)] && this.crudObj.sourceEvent[parseInt(i.toString(), 10)].groupIndex !== this.crudObj.targetEvent[parseInt(i.toString(), 10)].groupIndex) {\n            templateNames.push('eventTemplate_' + this.crudObj.targetEvent[parseInt(i.toString(), 10)].groupIndex);\n          }\n        }\n      }\n      if (templateNames.length > 0) {\n        this.parent.resetTemplates(templateNames);\n      }\n    }\n    if (isVirtualScrollAction) {\n      this.parent.notify(events.dataReady, {\n        processedData: dynamicEvents ? this.parent.eventBase.processData(dynamicEvents) : this.parent.eventsProcessed\n      });\n      return;\n    }\n    var eventsData = this.parent.eventsData || [];\n    var blockData = this.parent.blockData || [];\n    var data = eventsData.concat(blockData);\n    this.parent.notify(events.dataReady, {\n      processedData: this.parent.eventBase ? this.parent.eventBase.processData(data) : []\n    });\n  };\n  Crud.prototype.refreshData = function (args) {\n    var _this = this;\n    var actionArgs = {\n      requestType: args.requestType,\n      cancel: false,\n      data: args.data,\n      addedRecords: args.editParams.addedRecords,\n      changedRecords: args.editParams.changedRecords,\n      deletedRecords: args.editParams.deletedRecords\n    };\n    if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj && this.parent.dragAndDropModule.actionObj.element && this.parent.dragAndDropModule.actionObj.action) {\n      this.parent.dragAndDropModule.actionObj.element.style.display = 'none';\n    }\n    if (this.parent.resizeModule && this.parent.resizeModule.actionObj && this.parent.resizeModule.actionObj.element && this.parent.resizeModule.actionObj.action) {\n      this.parent.resizeModule.actionObj.element.style.display = 'none';\n    }\n    if (this.parent.isSpecificResourceEvents()) {\n      if (args.requestType === 'eventCreated' || args.requestType === 'eventRemoved') {\n        this.crudObj.isCrudAction = true;\n        this.crudObj.sourceEvent = [];\n        var crudData = args.data instanceof Array ? args.data.length === 0 && args.requestType === 'eventRemoved' ? args.editParams.deletedRecords : args.data : (typeof args.data === 'string' || typeof args.data === 'number') && args.requestType === 'eventRemoved' ? args.editParams.deletedRecords : [args.data];\n        var _loop_1 = function (data) {\n          this_1.crudObj.isCrudAction = !(args.requestType === 'eventRemoved' && !isNullOrUndefined(data.parent));\n          var groupIndex = this_1.parent.eventBase.getGroupIndexFromEvent(data);\n          if (groupIndex > -1 && this_1.parent.crudModule.crudObj.sourceEvent.filter(function (tdData) {\n            return tdData.groupIndex === groupIndex;\n          }).length === 0 && this_1.crudObj.isCrudAction) {\n            this_1.crudObj.sourceEvent.push(this_1.parent.resourceBase.lastResourceLevel[parseInt(groupIndex.toString(), 10)]);\n          }\n        };\n        var this_1 = this;\n        for (var _i = 0, crudData_1 = crudData; _i < crudData_1.length; _i++) {\n          var data = crudData_1[_i];\n          _loop_1(data);\n        }\n        this.crudObj.targetEvent = this.crudObj.sourceEvent;\n      }\n    }\n    if (this.parent.dataModule.dataManager.dataSource.offline) {\n      this.parent.trigger(events.actionComplete, actionArgs, function (offlineArgs) {\n        if (!offlineArgs.cancel) {\n          _this.refreshDataManager();\n        }\n      });\n    } else {\n      args.promise.then(function () {\n        if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n          return;\n        }\n        _this.parent.trigger(events.actionComplete, actionArgs, function (onlineArgs) {\n          if (!onlineArgs.cancel) {\n            _this.refreshDataManager();\n          }\n        });\n      }).catch(function (e) {\n        if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n          return;\n        }\n        _this.parent.trigger(events.actionFailure, {\n          error: e\n        });\n      });\n    }\n  };\n  Crud.prototype.processAddEvent = function (addArgs) {\n    var fields = this.parent.eventFields;\n    var editParams = {\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: []\n    };\n    var promise;\n    if (addArgs.addedRecords instanceof Array) {\n      for (var _i = 0, _a = addArgs.addedRecords; _i < _a.length; _i++) {\n        var event_1 = _a[_i];\n        event_1 = this.parent.eventBase.updateEventDateTime(event_1);\n        var eventData = extend({}, this.parent.eventBase.processTimezone(event_1, true), null, true);\n        editParams.addedRecords.push(eventData);\n      }\n      promise = this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, this.getTable(), this.getQuery());\n    } else {\n      var event_2 = this.parent.eventBase.processTimezone(addArgs.addedRecords, true);\n      editParams.addedRecords.push(event_2);\n      promise = this.parent.dataModule.dataManager.insert(event_2, this.getTable(), this.getQuery());\n    }\n    var crudArgs = {\n      requestType: 'eventCreated',\n      cancel: false,\n      data: addArgs.addedRecords,\n      promise: promise,\n      editParams: editParams\n    };\n    this.refreshData(crudArgs);\n  };\n  Crud.prototype.processSaveEvent = function (saveArgs) {\n    var promise;\n    var fields = this.parent.eventFields;\n    var editParams = {\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: []\n    };\n    if (saveArgs.changedRecords instanceof Array) {\n      for (var _i = 0, _a = saveArgs.changedRecords; _i < _a.length; _i++) {\n        var event_3 = _a[_i];\n        event_3 = this.parent.eventBase.updateEventDateTime(event_3);\n        var eventData = extend({}, this.parent.eventBase.processTimezone(event_3, true), null, true);\n        editParams.changedRecords.push(eventData);\n      }\n      promise = this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, this.getTable(), this.getQuery());\n    } else {\n      var event_4 = this.parent.eventBase.processTimezone(saveArgs.changedRecords, true);\n      editParams.changedRecords.push(event_4);\n      promise = this.parent.dataModule.dataManager.update(fields.id, event_4, this.getTable(), this.getQuery());\n    }\n    var cloneEvent = extend({}, saveArgs.changedRecords[saveArgs.changedRecords.length - 1], null, true);\n    this.parent.eventBase.selectWorkCellByTime([this.parent.eventBase.processTimezone(cloneEvent)]);\n    var crudArgs = {\n      requestType: 'eventChanged',\n      cancel: false,\n      data: saveArgs.changedRecords,\n      promise: promise,\n      editParams: editParams\n    };\n    this.refreshData(crudArgs);\n  };\n  Crud.prototype.processDeleteEvent = function (deleteArgs) {\n    var promise;\n    var fields = this.parent.eventFields;\n    var editParams = {\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: []\n    };\n    if (deleteArgs.deletedRecords.length > 1) {\n      editParams.deletedRecords = editParams.deletedRecords.concat(deleteArgs.deletedRecords);\n      promise = this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, this.getTable(), this.getQuery());\n    } else {\n      editParams.deletedRecords.push(deleteArgs.deletedRecords[0]);\n      promise = this.parent.dataModule.dataManager.remove(fields.id, deleteArgs.deletedRecords[0], this.getTable(), this.getQuery());\n    }\n    this.parent.eventBase.selectWorkCellByTime(deleteArgs.deletedRecords);\n    var crudArgs = {\n      requestType: 'eventRemoved',\n      cancel: false,\n      data: deleteArgs.deletedRecords,\n      promise: promise,\n      editParams: editParams\n    };\n    this.refreshData(crudArgs);\n  };\n  Crud.prototype.addEvent = function (eventData) {\n    var _this = this;\n    if (this.parent.eventSettings.allowAdding && !this.parent.activeViewOptions.readonly) {\n      if (!this.isBlockEvent(eventData) && this.parent.eventBase.isBlockRange(eventData)) {\n        this.parent.quickPopup.openValidationError('blockAlert', eventData);\n        return;\n      }\n      if (this.parent.eventBase.checkOverlap(eventData)) {\n        return;\n      }\n      var addEvents = eventData instanceof Array ? eventData : [eventData];\n      if (addEvents.length === 0) {\n        return;\n      }\n      var args = {\n        requestType: 'eventCreate',\n        cancel: false,\n        data: addEvents,\n        addedRecords: addEvents,\n        changedRecords: [],\n        deletedRecords: []\n      };\n      this.parent.trigger(events.actionBegin, args, function (addArgs) {\n        if (!addArgs.cancel) {\n          if (addArgs.promise) {\n            addArgs.promise.then(function (hasContinue) {\n              if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                return;\n              }\n              if (hasContinue) {\n                _this.processAddEvent(addArgs);\n              }\n            }).catch(function (e) {\n              if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                return;\n              }\n              _this.parent.trigger(events.actionFailure, {\n                error: e\n              });\n            });\n          } else {\n            _this.processAddEvent(addArgs);\n          }\n        }\n      });\n    }\n  };\n  Crud.prototype.saveEvent = function (eventData, action) {\n    var _this = this;\n    if (this.parent.eventSettings.allowEditing && !this.parent.activeViewOptions.readonly) {\n      if (this.parent.currentAction !== 'EditFollowingEvents' && !this.isBlockEvent(eventData) && this.parent.eventBase.isBlockRange(eventData)) {\n        this.parent.quickPopup.openValidationError('blockAlert', eventData);\n        this.parent.crudModule.crudObj.isCrudAction = false;\n        return;\n      }\n      var updateEvents = eventData instanceof Array ? eventData : [eventData];\n      if (updateEvents.length === 0) {\n        return;\n      }\n      this.parent.currentAction = action;\n      if (action) {\n        switch (action) {\n          case 'Save':\n            this.processSave(eventData);\n            break;\n          case 'EditOccurrence':\n            this.processOccurrences(eventData, action);\n            break;\n          case 'EditFollowingEvents':\n            this.processFollowSeries(eventData, action);\n            break;\n          case 'EditSeries':\n            this.processEntireSeries(eventData, action);\n            break;\n        }\n      } else {\n        if (this.parent.eventBase.checkOverlap(eventData)) {\n          return;\n        }\n        var args = {\n          requestType: 'eventChange',\n          cancel: false,\n          data: eventData,\n          addedRecords: [],\n          changedRecords: updateEvents,\n          deletedRecords: []\n        };\n        this.parent.trigger(events.actionBegin, args, function (saveArgs) {\n          if (!saveArgs.cancel) {\n            if (saveArgs.promise) {\n              saveArgs.promise.then(function (hasContinue) {\n                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                  return;\n                }\n                if (hasContinue) {\n                  _this.processSaveEvent(saveArgs);\n                }\n              }).catch(function (e) {\n                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                  return;\n                }\n                _this.parent.trigger(events.actionFailure, {\n                  error: e\n                });\n              });\n            } else {\n              _this.processSaveEvent(saveArgs);\n            }\n          }\n        });\n      }\n    }\n  };\n  Crud.prototype.deleteEvent = function (eventData, action) {\n    var _this = this;\n    if (this.parent.eventSettings.allowDeleting && !this.parent.activeViewOptions.readonly) {\n      this.parent.currentAction = action;\n      var deleteEvents = [];\n      if (typeof eventData === 'string' || typeof eventData === 'number') {\n        deleteEvents = this.parent.eventsData.filter(function (eventObj) {\n          return eventObj[_this.parent.eventFields.id] === eventData;\n        });\n      } else {\n        deleteEvents = eventData instanceof Array ? eventData : [eventData];\n      }\n      if (deleteEvents.length === 0) {\n        return;\n      }\n      if (action) {\n        switch (action) {\n          case 'Delete':\n            this.processDelete(deleteEvents);\n            break;\n          case 'DeleteOccurrence':\n            this.processOccurrences(deleteEvents, action);\n            break;\n          case 'DeleteFollowingEvents':\n            this.processFollowSeries(deleteEvents, action);\n            break;\n          case 'DeleteSeries':\n            this.processEntireSeries(deleteEvents, action);\n            break;\n        }\n      } else {\n        var args = {\n          requestType: 'eventRemove',\n          cancel: false,\n          data: eventData,\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: deleteEvents\n        };\n        this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n          if (!deleteArgs.cancel) {\n            if (deleteArgs.promise) {\n              deleteArgs.promise.then(function (hasContinue) {\n                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                  return;\n                }\n                if (hasContinue) {\n                  _this.processDeleteEvent(deleteArgs);\n                }\n              }).catch(function (e) {\n                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                  return;\n                }\n                _this.parent.trigger(events.actionFailure, {\n                  error: e\n                });\n              });\n            } else {\n              _this.processDeleteEvent(deleteArgs);\n            }\n          }\n        });\n      }\n    }\n  };\n  Crud.prototype.processOccurrences = function (eventData, action) {\n    var _this = this;\n    var occurrenceData = [];\n    var isDeletedRecords = false;\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_1 = eventData; _i < eventData_1.length; _i++) {\n        var event_5 = eventData_1[_i];\n        occurrenceData.push({\n          occurrence: event_5,\n          parent: this.getParentEvent(event_5)\n        });\n      }\n    } else {\n      occurrenceData = {\n        occurrence: eventData,\n        parent: this.getParentEvent(eventData)\n      };\n    }\n    var updateEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditOccurrence' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: updateEvents,\n      deletedRecords: []\n    };\n    args.data = occurrenceData;\n    this.parent.trigger(events.actionBegin, args, function (occurrenceArgs) {\n      if (!occurrenceArgs.cancel) {\n        var fields = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var occurrenceEvents = occurrenceData instanceof Array ? occurrenceData : [occurrenceData];\n        var _loop_2 = function (a, count) {\n          var childEvent = occurrenceArgs.changedRecords[parseInt(a.toString(), 10)];\n          var parentEvent = occurrenceEvents[parseInt(a.toString(), 10)].parent;\n          var parentException = parentEvent[fields.recurrenceException];\n          var editedData = void 0;\n          var exceptionDate = void 0;\n          switch (action) {\n            case 'EditOccurrence':\n              editedData = _this.parent.eventsProcessed.filter(function (event) {\n                return event.Guid === childEvent.Guid;\n              })[0];\n              exceptionDate = _this.excludeDateCheck(editedData[fields.startTime], parentException);\n              if (exceptionDate !== parentEvent[fields.recurrenceException]) {\n                parentEvent[fields.recurrenceException] = exceptionDate;\n                childEvent[fields.recurrenceException] = getRecurrenceStringFromDate(editedData[fields.startTime]);\n                childEvent[fields.recurrenceID] = parentEvent[fields.id];\n                childEvent[fields.followingID] = null;\n                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                editParams.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              } else {\n                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              }\n              break;\n            case 'DeleteOccurrence':\n              if (!childEvent[fields.recurrenceException]) {\n                parentEvent[fields.recurrenceException] = _this.excludeDateCheck(childEvent[fields.startTime], parentException);\n                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n              }\n              if (childEvent[fields.id] !== parentEvent[fields.id]) {\n                editParams.deletedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                isDeletedRecords = true;\n              }\n              break;\n          }\n        };\n        for (var a = 0, count = occurrenceArgs.changedRecords.length; a < count; a++) {\n          _loop_2(a, count);\n        }\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n        var cloneEvent = extend({}, occurrenceArgs.changedRecords[occurrenceArgs.changedRecords.length - 1], null, true);\n        _this.parent.eventBase.selectWorkCellByTime(action === 'EditOccurrence' ? [_this.parent.eventBase.processTimezone(cloneEvent)] : [cloneEvent]);\n        var crudArgs = {\n          requestType: action === 'EditOccurrence' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: isDeletedRecords ? occurrenceArgs.deletedRecords : occurrenceArgs.changedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n  Crud.prototype.processFollowSeries = function (eventData, action) {\n    var _this = this;\n    var followData = [];\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_2 = eventData; _i < eventData_2.length; _i++) {\n        var event_6 = eventData_2[_i];\n        followData.push({\n          occurrence: event_6,\n          parent: this.getParentEvent(event_6)\n        });\n      }\n    } else {\n      followData = {\n        occurrence: eventData,\n        parent: this.getParentEvent(eventData)\n      };\n    }\n    var updateFollowEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditFollowingEvents' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: updateFollowEvents,\n      deletedRecords: []\n    };\n    args.data = followData;\n    this.parent.trigger(events.actionBegin, args, function (followArgs) {\n      if (!followArgs.cancel) {\n        var fields_1 = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var followEvents = followData instanceof Array ? followData : [followData];\n        var _loop_3 = function (a, count) {\n          var childEvent = followArgs.changedRecords[parseInt(a.toString(), 10)];\n          var parentEvent = followEvents[parseInt(a.toString(), 10)].parent;\n          var followData_1 = _this.parent.eventBase.getEventCollections(parentEvent, childEvent);\n          var isSpanned = void 0;\n          switch (action) {\n            case 'EditFollowingEvents':\n              _this.processRecurrenceRule(parentEvent, childEvent);\n              isSpanned = !_this.parent.eventBase.isFollowingEvent(parentEvent, childEvent);\n              childEvent[fields_1.followingID] = isSpanned ? null : parentEvent[fields_1.id];\n              childEvent[fields_1.recurrenceID] = null;\n              editParams.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n              if (!_this.parent.uiStateValues.isIgnoreOccurrence) {\n                childEvent[fields_1.recurrenceException] = null;\n                if (followData_1.occurrence.length > 0) {\n                  var rule = followData_1.occurrence.slice(-1)[0][fields_1.recurrenceRule];\n                  if (rule.indexOf('COUNT') === -1) {\n                    childEvent[fields_1.recurrenceRule] = rule;\n                  }\n                }\n                if (followData_1.follow.length > 0) {\n                  childEvent[fields_1.recurrenceRule] = followData_1.follow.slice(-1)[0][fields_1.recurrenceRule];\n                  editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.follow);\n                }\n                if (isSpanned) {\n                  followData_1.occurrence = followData_1.occurrence.filter(function (eventObj) {\n                    return eventObj[fields_1.recurrenceID] === parentEvent[fields_1.id];\n                  });\n                }\n                editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.occurrence);\n              }\n              break;\n            case 'DeleteFollowingEvents':\n              _this.processRecurrenceRule(parentEvent, childEvent[fields_1.startTime]);\n              editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n              editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.occurrence).concat(followData_1.follow);\n              break;\n          }\n        };\n        for (var a = 0, count = followArgs.changedRecords.length; a < count; a++) {\n          _loop_3(a, count);\n        }\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_1.id, _this.getTable(), _this.getQuery());\n        var cloneEvent = extend({}, followArgs.changedRecords[followArgs.changedRecords.length - 1], null, true);\n        _this.parent.eventBase.selectWorkCellByTime(action === 'EditFollowingEvents' ? [_this.parent.eventBase.processTimezone(cloneEvent)] : [cloneEvent]);\n        var crudArgs = {\n          requestType: action === 'EditFollowingEvents' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: followArgs.changedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n  Crud.prototype.processEntireSeries = function (eventData, action) {\n    var _this = this;\n    var seriesData = [];\n    var isDeletedRecords = false;\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_3 = eventData; _i < eventData_3.length; _i++) {\n        var event_7 = eventData_3[_i];\n        seriesData.push(this.getParentEvent(event_7, true));\n      }\n    } else {\n      seriesData = this.getParentEvent(eventData, true);\n    }\n    var updateSeriesEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditSeries' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: []\n    };\n    args.data = seriesData;\n    if (action === 'EditSeries') {\n      args.changedRecords = updateSeriesEvents;\n    } else {\n      args.deletedRecords = updateSeriesEvents;\n    }\n    if (action === 'EditSeries' && !this.parent.uiStateValues.isIgnoreOccurrence) {\n      var seriesEvents = seriesData instanceof Array ? seriesData : [seriesData];\n      for (var a = 0, count = args.changedRecords.length; a < count; a++) {\n        var parentEvent = seriesEvents[parseInt(a.toString(), 10)];\n        var eventCollections = this.parent.eventBase.getEventCollections(parentEvent);\n        var deletedEvents = eventCollections.follow.concat(eventCollections.occurrence);\n        args.deletedRecords = args.deletedRecords.concat(deletedEvents);\n      }\n    }\n    this.parent.trigger(events.actionBegin, args, function (seriesArgs) {\n      if (!seriesArgs.cancel) {\n        var fields_2 = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var seriesEvents = seriesData instanceof Array ? seriesData : [seriesData];\n        var records = action === 'EditSeries' ? seriesArgs.changedRecords : seriesArgs.deletedRecords;\n        var _loop_4 = function (a, count) {\n          var childEvent = records[parseInt(a.toString(), 10)];\n          var parentEvent = seriesEvents[parseInt(a.toString(), 10)];\n          var eventCollections = _this.parent.eventBase.getEventCollections(parentEvent);\n          var deletedEvents = eventCollections.follow.concat(eventCollections.occurrence);\n          switch (action) {\n            case 'EditSeries':\n              childEvent[fields_2.id] = parentEvent[fields_2.id];\n              childEvent[fields_2.recurrenceID] = null;\n              childEvent[fields_2.followingID] = null;\n              if (_this.parent.uiStateValues.isIgnoreOccurrence && childEvent[fields_2.recurrenceException]) {\n                var originalParent = _this.parent.eventsData.filter(function (eventObj) {\n                  return eventObj[fields_2.id] === childEvent[fields_2.id];\n                });\n                if (originalParent.length > 0) {\n                  childEvent[fields_2.recurrenceRule] = originalParent[0][fields_2.recurrenceRule];\n                }\n              } else {\n                childEvent[fields_2.recurrenceException] = null;\n                editParams.deletedRecords = editParams.deletedRecords.concat(deletedEvents);\n              }\n              editParams.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              _this.parent.uiStateValues.isIgnoreOccurrence = false;\n              break;\n            case 'DeleteSeries':\n              editParams.deletedRecords = editParams.deletedRecords.concat(deletedEvents.concat(_this.parent.eventBase.processTimezone(parentEvent, true)));\n              isDeletedRecords = true;\n              break;\n          }\n        };\n        for (var a = 0, count = records.length; a < count; a++) {\n          _loop_4(a, count);\n        }\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_2.id, _this.getTable(), _this.getQuery());\n        var cloneEvent = extend({}, records[records.length - 1], null, true);\n        _this.parent.eventBase.selectWorkCellByTime(action === 'EditSeries' ? [_this.parent.eventBase.processTimezone(cloneEvent)] : [cloneEvent]);\n        var crudArgs = {\n          requestType: action === 'EditSeries' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: isDeletedRecords ? seriesArgs.deletedRecords : seriesArgs.changedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n  Crud.prototype.processDelete = function (eventData) {\n    var _this = this;\n    var deleteData = [];\n    for (var _i = 0, eventData_4 = eventData; _i < eventData_4.length; _i++) {\n      var eventObj = eventData_4[_i];\n      if (eventObj[this.parent.eventFields.recurrenceRule]) {\n        deleteData.push({\n          occurrence: eventObj,\n          parent: this.getParentEvent(eventObj)\n        });\n      } else {\n        deleteData.push(eventObj);\n      }\n    }\n    var args = {\n      requestType: 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: eventData\n    };\n    args.data = deleteData;\n    this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n      if (!deleteArgs.cancel) {\n        var fields_3 = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var _loop_5 = function (a, count) {\n          var isDelete = isNullOrUndefined(deleteArgs.deletedRecords[parseInt(a.toString(), 10)][_this.parent.eventFields.recurrenceRule]);\n          if (!isDelete) {\n            var parentEvent_1 = deleteData[parseInt(a.toString(), 10)].parent;\n            var isEdited = editParams.changedRecords.filter(function (obj) {\n              return obj[fields_3.id] === parentEvent_1[fields_3.id];\n            });\n            var editedDate = deleteArgs.deletedRecords[parseInt(a.toString(), 10)][fields_3.startTime];\n            if (isEdited.length > 0) {\n              var editedData = isEdited[0];\n              editedData[fields_3.recurrenceException] = _this.excludeDateCheck(editedDate, editedData[fields_3.recurrenceException]);\n            } else {\n              parentEvent_1[fields_3.recurrenceException] = _this.excludeDateCheck(editedDate, parentEvent_1[fields_3.recurrenceException]);\n            }\n            if (isEdited.length === 0) {\n              editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent_1, true));\n            }\n            isDelete = deleteArgs.deletedRecords[parseInt(a.toString(), 10)][fields_3.id] !== parentEvent_1[fields_3.id];\n          }\n          if (isDelete) {\n            if (deleteArgs.deletedRecords instanceof Array) {\n              for (var _i = 0, _a = deleteArgs.deletedRecords; _i < _a.length; _i++) {\n                var event_8 = _a[_i];\n                _this.parent.eventBase.processTimezone(event_8, true);\n              }\n            }\n            editParams.deletedRecords.push(deleteArgs.deletedRecords[parseInt(a.toString(), 10)]);\n          }\n        };\n        for (var a = 0, count = deleteArgs.deletedRecords.length; a < count; a++) {\n          _loop_5(a, count);\n        }\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_3.id, _this.getTable(), _this.getQuery());\n        var cloneEvent = extend({}, deleteArgs.deletedRecords[deleteArgs.deletedRecords.length - 1], null, true);\n        _this.parent.eventBase.selectWorkCellByTime([_this.parent.eventBase.processTimezone(cloneEvent)]);\n        var crudArgs = {\n          requestType: 'eventRemoved',\n          cancel: false,\n          data: deleteArgs.deletedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n  Crud.prototype.processSave = function (data) {\n    var _this = this;\n    var eventData = data instanceof Array ? data : [data];\n    var editData = [];\n    for (var _i = 0, eventData_5 = eventData; _i < eventData_5.length; _i++) {\n      var eventObj = eventData_5[_i];\n      if (eventObj[this.parent.eventFields.recurrenceRule]) {\n        editData.push({\n          occurrence: eventObj,\n          parent: this.getParentEvent(eventObj)\n        });\n      } else {\n        editData.push(eventObj);\n      }\n    }\n    var args = {\n      requestType: 'eventChange',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: eventData,\n      deletedRecords: []\n    };\n    args.data = editData;\n    this.parent.trigger(events.actionBegin, args, function (editArgs) {\n      if (!editArgs.cancel) {\n        var fields = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        for (var _i = 0, _a = editArgs.changedRecords; _i < _a.length; _i++) {\n          var record = _a[_i];\n          if (!isNullOrUndefined(record[fields.recurrenceRule]) && isNullOrUndefined(record[fields.recurrenceException])) {\n            var exceptionString = getRecurrenceStringFromDate(record[fields.startTime]);\n            var parentEle = _this.getParentEvent(record);\n            parentEle[fields.recurrenceException] = isNullOrUndefined(parentEle[fields.recurrenceException]) ? exceptionString : parentEle[fields.recurrenceException].concat(',' + exceptionString);\n            record[fields.id] = _this.parent.getEventMaxID();\n            record[fields.recurrenceException] = exceptionString;\n            editParams.addedRecords.push(_this.parent.eventBase.processTimezone(record, true));\n            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEle, true));\n          } else {\n            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(record, true));\n          }\n        }\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n        var cloneEvent = extend({}, editArgs.changedRecords[editArgs.changedRecords.length - 1], null, true);\n        _this.parent.eventBase.selectWorkCellByTime([_this.parent.eventBase.processTimezone(cloneEvent)]);\n        var crudArgs = {\n          requestType: 'eventChanged',\n          cancel: false,\n          data: editArgs.changedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n  Crud.prototype.getParentEvent = function (event, isParent) {\n    if (isParent === void 0) {\n      isParent = false;\n    }\n    var parentEvent = this.parent.eventBase.getParentEvent(event, isParent) || event;\n    if (parentEvent[this.parent.eventFields.startTimezone] || parentEvent[this.parent.eventFields.endTimezone]) {\n      this.parent.eventBase.timezoneConvert(parentEvent);\n    }\n    return parentEvent;\n  };\n  Crud.prototype.excludeDateCheck = function (eventStartTime, exceptionDateList) {\n    var timezone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n    if (timezone) {\n      eventStartTime = this.parent.tzModule.remove(new Date(+eventStartTime.getTime()), timezone);\n    }\n    var exDate = getRecurrenceStringFromDate(eventStartTime);\n    if (!isNullOrUndefined(exceptionDateList)) {\n      if (exceptionDateList.indexOf(exDate) === -1) {\n        exceptionDateList = !isNullOrUndefined(exceptionDateList) ? exceptionDateList + ',' + exDate : exDate;\n      }\n    } else {\n      exceptionDateList = exDate;\n    }\n    return exceptionDateList;\n  };\n  Crud.prototype.processRecurrenceRule = function (parentEvent, followEvent) {\n    var fields = this.parent.eventFields;\n    var recurrenceRule = parentEvent[fields.recurrenceRule];\n    var endDate;\n    if (followEvent instanceof Date) {\n      endDate = new Date(+followEvent);\n    } else {\n      endDate = new Date(+followEvent[fields.startTime]);\n      var newRecurrenceRule = followEvent[fields.recurrenceRule];\n      if (newRecurrenceRule) {\n        var startDate = parentEvent[fields.startTime];\n        var ruleException = this.parent.currentAction === 'DeleteFollowingEvents' ? followEvent[fields.recurrenceException] : null;\n        var dateCollection = generate(startDate, newRecurrenceRule, ruleException, this.parent.activeViewOptions.firstDayOfWeek);\n        var untilDate = new Date(dateCollection.slice(-1)[0]);\n        untilDate.setHours(endDate.getHours(), endDate.getMinutes(), endDate.getSeconds());\n        endDate.setHours(startDate.getHours(), startDate.getMinutes(), startDate.getSeconds());\n        followEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(newRecurrenceRule, new Date(+untilDate), false);\n      }\n    }\n    parentEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(recurrenceRule, util.addDays(new Date(endDate.getTime()), -1), true);\n  };\n  Crud.prototype.getUpdatedRecurrenceRule = function (recurrenceRule, untilDate, isParent) {\n    var splitRule = recurrenceRule.split(';');\n    var updatedRule = '';\n    for (var _i = 0, splitRule_1 = splitRule; _i < splitRule_1.length; _i++) {\n      var rule = splitRule_1[_i];\n      if (rule !== '') {\n        var ruleKey = rule.split('=')[0];\n        var ruleValue = rule.split('=')[1];\n        if (ruleKey === 'COUNT' || ruleKey === 'UNTIL') {\n          ruleValue = getRecurrenceStringFromDate(untilDate);\n          rule = rule.replace(rule, 'UNTIL=' + ruleValue);\n        }\n        updatedRule += rule + ';';\n      }\n    }\n    if (isParent && updatedRule.indexOf('UNTIL') === -1) {\n      updatedRule += 'UNTIL=' + getRecurrenceStringFromDate(untilDate);\n    }\n    return updatedRule;\n  };\n  Crud.prototype.isBlockEvent = function (eventData) {\n    var eventCollection = eventData instanceof Array ? eventData : [eventData];\n    var value = false;\n    for (var _i = 0, eventCollection_1 = eventCollection; _i < eventCollection_1.length; _i++) {\n      var event_9 = eventCollection_1[_i];\n      value = event_9[this.parent.eventFields.isBlock] || false;\n    }\n    return value;\n  };\n  /**\n   * To destroy the crud module.\n   *\n   * @returns {void}\n   * @private\n   */\n  Crud.prototype.destroy = function () {\n    this.crudObj = null;\n    this.parent = null;\n  };\n  return Crud;\n}();\nexport { Crud };","map":{"version":3,"names":["isNullOrUndefined","extend","removeClass","getRecurrenceStringFromDate","generate","events","util","Crud","parent","crudObj","sourceEvent","targetEvent","isCrudAction","prototype","getQuery","start","activeView","startDate","end","endDate","dataModule","generateQuery","getTable","eventSettings","query","clone","fromTable","refreshDataManager","_this","uiStateValues","isPreventEventRefresh","refreshEvents","hideSpinner","dataManager","getData","then","e","dataManagerSuccess","catch","dataManagerFailure","isDestroyed","trigger","dataBinding","args","cancel","resultData","result","eventsData","filter","data","eventFields","isBlock","blockData","refreshProcessedData","dragAndDropModule","actionObj","action","navigationWrapper","dataBound","isPrinting","setTimeout","notify","print","actionFailure","error","isVirtualScrollAction","dynamicEvents","element","activeViewOptions","eventTemplate","templateNames","indexOf","currentView","i","len","length","push","parseInt","toString","groupIndex","resetTemplates","dataReady","processedData","eventBase","processData","eventsProcessed","concat","refreshData","actionArgs","requestType","addedRecords","editParams","changedRecords","deletedRecords","style","display","resizeModule","isSpecificResourceEvents","crudData","Array","_loop_1","this_1","getGroupIndexFromEvent","crudModule","tdData","resourceBase","lastResourceLevel","_i","crudData_1","dataSource","offline","actionComplete","offlineArgs","promise","onlineArgs","processAddEvent","addArgs","fields","_a","event_1","updateEventDateTime","eventData","processTimezone","saveChanges","id","event_2","insert","crudArgs","processSaveEvent","saveArgs","event_3","event_4","update","cloneEvent","selectWorkCellByTime","processDeleteEvent","deleteArgs","remove","addEvent","allowAdding","readonly","isBlockEvent","isBlockRange","quickPopup","openValidationError","checkOverlap","addEvents","actionBegin","hasContinue","saveEvent","allowEditing","currentAction","updateEvents","processSave","processOccurrences","processFollowSeries","processEntireSeries","deleteEvent","allowDeleting","deleteEvents","eventObj","processDelete","occurrenceData","isDeletedRecords","eventData_1","event_5","occurrence","getParentEvent","occurrenceArgs","occurrenceEvents","_loop_2","a","count","childEvent","parentEvent","parentException","recurrenceException","editedData","exceptionDate","event","Guid","excludeDateCheck","startTime","recurrenceID","followingID","followData","eventData_2","event_6","updateFollowEvents","followArgs","fields_1","followEvents","_loop_3","followData_1","getEventCollections","isSpanned","processRecurrenceRule","isFollowingEvent","isIgnoreOccurrence","rule","slice","recurrenceRule","follow","seriesData","eventData_3","event_7","updateSeriesEvents","seriesEvents","eventCollections","deletedEvents","seriesArgs","fields_2","records","_loop_4","originalParent","deleteData","eventData_4","fields_3","_loop_5","isDelete","parentEvent_1","isEdited","obj","editedDate","event_8","editData","eventData_5","editArgs","record","exceptionString","parentEle","getEventMaxID","isParent","startTimezone","endTimezone","timezoneConvert","eventStartTime","exceptionDateList","timezone","tzModule","getLocalTimezoneName","Date","getTime","exDate","followEvent","newRecurrenceRule","ruleException","dateCollection","firstDayOfWeek","untilDate","setHours","getHours","getMinutes","getSeconds","getUpdatedRecurrenceRule","addDays","splitRule","split","updatedRule","splitRule_1","ruleKey","ruleValue","replace","eventCollection","value","eventCollection_1","event_9","destroy"],"sources":["C:/Users/Dell/OneDrive/Desktop/Programs/soc-portal/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/crud.js"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable max-len */\nimport { isNullOrUndefined, extend, removeClass } from '@syncfusion/ej2-base';\nimport { getRecurrenceStringFromDate, generate } from '../../recurrence-editor/date-generator';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\n/**\n * Schedule CRUD operations\n */\nvar Crud = /** @class */ (function () {\n    function Crud(parent) {\n        this.parent = parent;\n        this.crudObj = { sourceEvent: null, targetEvent: null, isCrudAction: false };\n    }\n    Crud.prototype.getQuery = function () {\n        var start = this.parent.activeView.startDate();\n        var end = this.parent.activeView.endDate();\n        return this.parent.dataModule.generateQuery(start, end);\n    };\n    Crud.prototype.getTable = function () {\n        if (this.parent.eventSettings.query) {\n            var query = this.parent.eventSettings.query.clone();\n            return query.fromTable;\n        }\n        return null;\n    };\n    Crud.prototype.refreshDataManager = function () {\n        var _this = this;\n        if (!this.parent.activeView) {\n            return;\n        }\n        if (this.parent.uiStateValues && this.parent.uiStateValues.isPreventEventRefresh) {\n            this.parent.uiStateValues.isPreventEventRefresh = false;\n            this.parent.refreshEvents(false);\n            this.parent.hideSpinner();\n            return;\n        }\n        var start = this.parent.activeView.startDate();\n        var end = this.parent.activeView.endDate();\n        var dataManager = this.parent.dataModule.getData(this.parent.dataModule.generateQuery(start, end));\n        dataManager.then(function (e) { return _this.dataManagerSuccess(e); }).catch(function (e) { return _this.dataManagerFailure(e); });\n    };\n    Crud.prototype.dataManagerSuccess = function (e) {\n        var _this = this;\n        if (!this.parent || this.parent && this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.trigger(events.dataBinding, e, function (args) {\n            if (args.cancel) {\n                return;\n            }\n            var resultData = extend([], args.result, null, true);\n            _this.parent.eventsData = resultData.filter(function (data) { return !data[_this.parent.eventFields.isBlock]; });\n            _this.parent.blockData = resultData.filter(function (data) { return data[_this.parent.eventFields.isBlock]; });\n            _this.refreshProcessedData();\n            if (_this.parent.dragAndDropModule && _this.parent.dragAndDropModule.actionObj.action === 'drag') {\n                _this.parent.dragAndDropModule.navigationWrapper();\n            }\n            _this.parent.trigger(events.dataBound, null, function () {\n                _this.parent.hideSpinner();\n                if (_this.parent.isPrinting) {\n                    setTimeout(function () {\n                        _this.parent.notify(events.print, {});\n                    }, 100);\n                }\n            });\n        });\n    };\n    Crud.prototype.dataManagerFailure = function (e) {\n        var _this = this;\n        if (!this.parent || this.parent && this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.trigger(events.actionFailure, { error: e }, function () { return _this.parent.hideSpinner(); });\n    };\n    Crud.prototype.refreshProcessedData = function (isVirtualScrollAction, dynamicEvents) {\n        if (isVirtualScrollAction === void 0) { isVirtualScrollAction = false; }\n        if (this.parent.dragAndDropModule) {\n            this.parent.dragAndDropModule.actionObj.action = '';\n            removeClass([this.parent.element], 'e-event-action');\n        }\n        if (this.parent.activeViewOptions && this.parent.activeViewOptions.eventTemplate) {\n            var templateNames = ['eventTemplate'];\n            if (this.crudObj.isCrudAction &&\n                ['Agenda', 'MonthAgenda', 'Year', 'TimelineYear'].indexOf(this.parent.currentView) === -1) {\n                templateNames = [];\n                for (var i = 0, len = this.crudObj.sourceEvent.length; i < len; i++) {\n                    templateNames.push('eventTemplate_' + this.crudObj.sourceEvent[parseInt(i.toString(), 10)].groupIndex);\n                    if (this.crudObj.targetEvent[parseInt(i.toString(), 10)] && this.crudObj.sourceEvent[parseInt(i.toString(), 10)].groupIndex !==\n                        this.crudObj.targetEvent[parseInt(i.toString(), 10)].groupIndex) {\n                        templateNames.push('eventTemplate_' + this.crudObj.targetEvent[parseInt(i.toString(), 10)].groupIndex);\n                    }\n                }\n            }\n            if (templateNames.length > 0) {\n                this.parent.resetTemplates(templateNames);\n            }\n        }\n        if (isVirtualScrollAction) {\n            this.parent.notify(events.dataReady, { processedData: dynamicEvents ? this.parent.eventBase.processData(dynamicEvents) : this.parent.eventsProcessed });\n            return;\n        }\n        var eventsData = this.parent.eventsData || [];\n        var blockData = this.parent.blockData || [];\n        var data = eventsData.concat(blockData);\n        this.parent.notify(events.dataReady, { processedData: this.parent.eventBase ? this.parent.eventBase.processData(data) : [] });\n    };\n    Crud.prototype.refreshData = function (args) {\n        var _this = this;\n        var actionArgs = {\n            requestType: args.requestType, cancel: false, data: args.data,\n            addedRecords: args.editParams.addedRecords, changedRecords: args.editParams.changedRecords,\n            deletedRecords: args.editParams.deletedRecords\n        };\n        if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj && this.parent.dragAndDropModule.actionObj.element && this.parent.dragAndDropModule.actionObj.action) {\n            this.parent.dragAndDropModule.actionObj.element.style.display = 'none';\n        }\n        if (this.parent.resizeModule && this.parent.resizeModule.actionObj && this.parent.resizeModule.actionObj.element && this.parent.resizeModule.actionObj.action) {\n            this.parent.resizeModule.actionObj.element.style.display = 'none';\n        }\n        if (this.parent.isSpecificResourceEvents()) {\n            if (args.requestType === 'eventCreated' || args.requestType === 'eventRemoved') {\n                this.crudObj.isCrudAction = true;\n                this.crudObj.sourceEvent = [];\n                var crudData = args.data instanceof Array ? (args.data.length === 0 &&\n                    args.requestType === 'eventRemoved' ? args.editParams.deletedRecords : args.data) :\n                    ((typeof args.data === 'string' || typeof args.data === 'number') && args.requestType === 'eventRemoved') ?\n                        args.editParams.deletedRecords : [args.data];\n                var _loop_1 = function (data) {\n                    this_1.crudObj.isCrudAction = !(args.requestType === 'eventRemoved' && !isNullOrUndefined(data.parent));\n                    var groupIndex = this_1.parent.eventBase.getGroupIndexFromEvent(data);\n                    if (groupIndex > -1 && this_1.parent.crudModule.crudObj.sourceEvent.filter(function (tdData) { return tdData.groupIndex === groupIndex; }).length === 0\n                        && this_1.crudObj.isCrudAction) {\n                        this_1.crudObj.sourceEvent.push(this_1.parent.resourceBase.lastResourceLevel[parseInt(groupIndex.toString(), 10)]);\n                    }\n                };\n                var this_1 = this;\n                for (var _i = 0, crudData_1 = crudData; _i < crudData_1.length; _i++) {\n                    var data = crudData_1[_i];\n                    _loop_1(data);\n                }\n                this.crudObj.targetEvent = this.crudObj.sourceEvent;\n            }\n        }\n        if (this.parent.dataModule.dataManager.dataSource.offline) {\n            this.parent.trigger(events.actionComplete, actionArgs, function (offlineArgs) {\n                if (!offlineArgs.cancel) {\n                    _this.refreshDataManager();\n                }\n            });\n        }\n        else {\n            args.promise.then(function () {\n                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                    return;\n                }\n                _this.parent.trigger(events.actionComplete, actionArgs, function (onlineArgs) {\n                    if (!onlineArgs.cancel) {\n                        _this.refreshDataManager();\n                    }\n                });\n            }).catch(function (e) {\n                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                    return;\n                }\n                _this.parent.trigger(events.actionFailure, { error: e });\n            });\n        }\n    };\n    Crud.prototype.processAddEvent = function (addArgs) {\n        var fields = this.parent.eventFields;\n        var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n        var promise;\n        if (addArgs.addedRecords instanceof Array) {\n            for (var _i = 0, _a = addArgs.addedRecords; _i < _a.length; _i++) {\n                var event_1 = _a[_i];\n                event_1 = this.parent.eventBase.updateEventDateTime(event_1);\n                var eventData = extend({}, this.parent.eventBase.processTimezone(event_1, true), null, true);\n                editParams.addedRecords.push(eventData);\n            }\n            promise = this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, this.getTable(), this.getQuery());\n        }\n        else {\n            var event_2 = this.parent.eventBase.processTimezone(addArgs.addedRecords, true);\n            editParams.addedRecords.push(event_2);\n            promise = this.parent.dataModule.dataManager.insert(event_2, this.getTable(), this.getQuery());\n        }\n        var crudArgs = {\n            requestType: 'eventCreated', cancel: false, data: addArgs.addedRecords, promise: promise, editParams: editParams\n        };\n        this.refreshData(crudArgs);\n    };\n    Crud.prototype.processSaveEvent = function (saveArgs) {\n        var promise;\n        var fields = this.parent.eventFields;\n        var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n        if (saveArgs.changedRecords instanceof Array) {\n            for (var _i = 0, _a = saveArgs.changedRecords; _i < _a.length; _i++) {\n                var event_3 = _a[_i];\n                event_3 = this.parent.eventBase.updateEventDateTime(event_3);\n                var eventData = extend({}, this.parent.eventBase.processTimezone(event_3, true), null, true);\n                editParams.changedRecords.push(eventData);\n            }\n            promise = this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, this.getTable(), this.getQuery());\n        }\n        else {\n            var event_4 = this.parent.eventBase.processTimezone(saveArgs.changedRecords, true);\n            editParams.changedRecords.push(event_4);\n            promise = this.parent.dataModule.dataManager.update(fields.id, event_4, this.getTable(), this.getQuery());\n        }\n        var cloneEvent = extend({}, saveArgs.changedRecords[saveArgs.changedRecords.length - 1], null, true);\n        this.parent.eventBase.selectWorkCellByTime([this.parent.eventBase.processTimezone(cloneEvent)]);\n        var crudArgs = {\n            requestType: 'eventChanged', cancel: false,\n            data: saveArgs.changedRecords, promise: promise, editParams: editParams\n        };\n        this.refreshData(crudArgs);\n    };\n    Crud.prototype.processDeleteEvent = function (deleteArgs) {\n        var promise;\n        var fields = this.parent.eventFields;\n        var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n        if (deleteArgs.deletedRecords.length > 1) {\n            editParams.deletedRecords = editParams.deletedRecords.concat(deleteArgs.deletedRecords);\n            promise = this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, this.getTable(), this.getQuery());\n        }\n        else {\n            editParams.deletedRecords.push(deleteArgs.deletedRecords[0]);\n            promise = this.parent.dataModule.dataManager.remove(fields.id, deleteArgs.deletedRecords[0], this.getTable(), this.getQuery());\n        }\n        this.parent.eventBase.selectWorkCellByTime(deleteArgs.deletedRecords);\n        var crudArgs = {\n            requestType: 'eventRemoved', cancel: false,\n            data: deleteArgs.deletedRecords, promise: promise, editParams: editParams\n        };\n        this.refreshData(crudArgs);\n    };\n    Crud.prototype.addEvent = function (eventData) {\n        var _this = this;\n        if (this.parent.eventSettings.allowAdding && !this.parent.activeViewOptions.readonly) {\n            if (!this.isBlockEvent(eventData) && this.parent.eventBase.isBlockRange(eventData)) {\n                this.parent.quickPopup.openValidationError('blockAlert', eventData);\n                return;\n            }\n            if (this.parent.eventBase.checkOverlap(eventData)) {\n                return;\n            }\n            var addEvents = (eventData instanceof Array) ? eventData : [eventData];\n            if (addEvents.length === 0) {\n                return;\n            }\n            var args = {\n                requestType: 'eventCreate', cancel: false, data: addEvents,\n                addedRecords: addEvents, changedRecords: [], deletedRecords: []\n            };\n            this.parent.trigger(events.actionBegin, args, function (addArgs) {\n                if (!addArgs.cancel) {\n                    if (addArgs.promise) {\n                        addArgs.promise.then(function (hasContinue) {\n                            if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                                return;\n                            }\n                            if (hasContinue) {\n                                _this.processAddEvent(addArgs);\n                            }\n                        }).catch(function (e) {\n                            if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                                return;\n                            }\n                            _this.parent.trigger(events.actionFailure, { error: e });\n                        });\n                    }\n                    else {\n                        _this.processAddEvent(addArgs);\n                    }\n                }\n            });\n        }\n    };\n    Crud.prototype.saveEvent = function (eventData, action) {\n        var _this = this;\n        if (this.parent.eventSettings.allowEditing && !this.parent.activeViewOptions.readonly) {\n            if (this.parent.currentAction !== 'EditFollowingEvents' && !this.isBlockEvent(eventData)\n                && this.parent.eventBase.isBlockRange(eventData)) {\n                this.parent.quickPopup.openValidationError('blockAlert', eventData);\n                this.parent.crudModule.crudObj.isCrudAction = false;\n                return;\n            }\n            var updateEvents = (eventData instanceof Array) ? eventData : [eventData];\n            if (updateEvents.length === 0) {\n                return;\n            }\n            this.parent.currentAction = action;\n            if (action) {\n                switch (action) {\n                    case 'Save':\n                        this.processSave(eventData);\n                        break;\n                    case 'EditOccurrence':\n                        this.processOccurrences(eventData, action);\n                        break;\n                    case 'EditFollowingEvents':\n                        this.processFollowSeries(eventData, action);\n                        break;\n                    case 'EditSeries':\n                        this.processEntireSeries(eventData, action);\n                        break;\n                }\n            }\n            else {\n                if (this.parent.eventBase.checkOverlap(eventData)) {\n                    return;\n                }\n                var args = {\n                    requestType: 'eventChange', cancel: false, data: eventData,\n                    addedRecords: [], changedRecords: updateEvents, deletedRecords: []\n                };\n                this.parent.trigger(events.actionBegin, args, function (saveArgs) {\n                    if (!saveArgs.cancel) {\n                        if (saveArgs.promise) {\n                            saveArgs.promise.then(function (hasContinue) {\n                                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                                    return;\n                                }\n                                if (hasContinue) {\n                                    _this.processSaveEvent(saveArgs);\n                                }\n                            }).catch(function (e) {\n                                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                                    return;\n                                }\n                                _this.parent.trigger(events.actionFailure, { error: e });\n                            });\n                        }\n                        else {\n                            _this.processSaveEvent(saveArgs);\n                        }\n                    }\n                });\n            }\n        }\n    };\n    Crud.prototype.deleteEvent = function (eventData, action) {\n        var _this = this;\n        if (this.parent.eventSettings.allowDeleting && !this.parent.activeViewOptions.readonly) {\n            this.parent.currentAction = action;\n            var deleteEvents = [];\n            if (typeof eventData === 'string' || typeof eventData === 'number') {\n                deleteEvents = this.parent.eventsData.filter(function (eventObj) {\n                    return eventObj[_this.parent.eventFields.id] === eventData;\n                });\n            }\n            else {\n                deleteEvents = (eventData instanceof Array ? eventData : [eventData]);\n            }\n            if (deleteEvents.length === 0) {\n                return;\n            }\n            if (action) {\n                switch (action) {\n                    case 'Delete':\n                        this.processDelete(deleteEvents);\n                        break;\n                    case 'DeleteOccurrence':\n                        this.processOccurrences(deleteEvents, action);\n                        break;\n                    case 'DeleteFollowingEvents':\n                        this.processFollowSeries(deleteEvents, action);\n                        break;\n                    case 'DeleteSeries':\n                        this.processEntireSeries(deleteEvents, action);\n                        break;\n                }\n            }\n            else {\n                var args = {\n                    requestType: 'eventRemove', cancel: false, data: eventData,\n                    addedRecords: [], changedRecords: [], deletedRecords: deleteEvents\n                };\n                this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n                    if (!deleteArgs.cancel) {\n                        if (deleteArgs.promise) {\n                            deleteArgs.promise.then(function (hasContinue) {\n                                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                                    return;\n                                }\n                                if (hasContinue) {\n                                    _this.processDeleteEvent(deleteArgs);\n                                }\n                            }).catch(function (e) {\n                                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                                    return;\n                                }\n                                _this.parent.trigger(events.actionFailure, { error: e });\n                            });\n                        }\n                        else {\n                            _this.processDeleteEvent(deleteArgs);\n                        }\n                    }\n                });\n            }\n        }\n    };\n    Crud.prototype.processOccurrences = function (eventData, action) {\n        var _this = this;\n        var occurrenceData = [];\n        var isDeletedRecords = false;\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_1 = eventData; _i < eventData_1.length; _i++) {\n                var event_5 = eventData_1[_i];\n                occurrenceData.push({ occurrence: event_5, parent: this.getParentEvent(event_5) });\n            }\n        }\n        else {\n            occurrenceData = { occurrence: eventData, parent: this.getParentEvent(eventData) };\n        }\n        var updateEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditOccurrence' ? 'eventChange' : 'eventRemove',\n            cancel: false,\n            addedRecords: [], changedRecords: updateEvents, deletedRecords: []\n        };\n        args.data = occurrenceData;\n        this.parent.trigger(events.actionBegin, args, function (occurrenceArgs) {\n            if (!occurrenceArgs.cancel) {\n                var fields = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var occurrenceEvents = (occurrenceData instanceof Array ? occurrenceData : [occurrenceData]);\n                var _loop_2 = function (a, count) {\n                    var childEvent = occurrenceArgs.changedRecords[parseInt(a.toString(), 10)];\n                    var parentEvent = occurrenceEvents[parseInt(a.toString(), 10)].parent;\n                    var parentException = parentEvent[fields.recurrenceException];\n                    var editedData = void 0;\n                    var exceptionDate = void 0;\n                    switch (action) {\n                        case 'EditOccurrence':\n                            editedData = _this.parent.eventsProcessed.filter(function (event) { return event.Guid === childEvent.Guid; })[0];\n                            exceptionDate = _this.excludeDateCheck(editedData[fields.startTime], parentException);\n                            if (exceptionDate !== parentEvent[fields.recurrenceException]) {\n                                parentEvent[fields.recurrenceException] = exceptionDate;\n                                childEvent[fields.recurrenceException] = getRecurrenceStringFromDate(editedData[fields.startTime]);\n                                childEvent[fields.recurrenceID] = parentEvent[fields.id];\n                                childEvent[fields.followingID] = null;\n                                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                                editParams.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            }\n                            else {\n                                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            }\n                            break;\n                        case 'DeleteOccurrence':\n                            if (!childEvent[fields.recurrenceException]) {\n                                parentEvent[fields.recurrenceException] =\n                                    _this.excludeDateCheck(childEvent[fields.startTime], parentException);\n                                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            }\n                            if (childEvent[fields.id] !== parentEvent[fields.id]) {\n                                editParams.deletedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                                isDeletedRecords = true;\n                            }\n                            break;\n                    }\n                };\n                for (var a = 0, count = occurrenceArgs.changedRecords.length; a < count; a++) {\n                    _loop_2(a, count);\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n                var cloneEvent = extend({}, occurrenceArgs.changedRecords[occurrenceArgs.changedRecords.length - 1], null, true);\n                _this.parent.eventBase.selectWorkCellByTime(action === 'EditOccurrence' ? [_this.parent.eventBase.processTimezone(cloneEvent)] : [cloneEvent]);\n                var crudArgs = {\n                    requestType: action === 'EditOccurrence' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: isDeletedRecords ? occurrenceArgs.deletedRecords : occurrenceArgs.changedRecords,\n                    promise: promise, editParams: editParams\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processFollowSeries = function (eventData, action) {\n        var _this = this;\n        var followData = [];\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_2 = eventData; _i < eventData_2.length; _i++) {\n                var event_6 = eventData_2[_i];\n                followData.push({ occurrence: event_6, parent: this.getParentEvent(event_6) });\n            }\n        }\n        else {\n            followData = { occurrence: eventData, parent: this.getParentEvent(eventData) };\n        }\n        var updateFollowEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditFollowingEvents' ? 'eventChange' : 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: updateFollowEvents, deletedRecords: []\n        };\n        args.data = followData;\n        this.parent.trigger(events.actionBegin, args, function (followArgs) {\n            if (!followArgs.cancel) {\n                var fields_1 = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var followEvents = followData instanceof Array ? followData : [followData];\n                var _loop_3 = function (a, count) {\n                    var childEvent = followArgs.changedRecords[parseInt(a.toString(), 10)];\n                    var parentEvent = followEvents[parseInt(a.toString(), 10)].parent;\n                    var followData_1 = _this.parent.eventBase.getEventCollections(parentEvent, childEvent);\n                    var isSpanned = void 0;\n                    switch (action) {\n                        case 'EditFollowingEvents':\n                            _this.processRecurrenceRule(parentEvent, childEvent);\n                            isSpanned = !_this.parent.eventBase.isFollowingEvent(parentEvent, childEvent);\n                            childEvent[fields_1.followingID] = isSpanned ? null : parentEvent[fields_1.id];\n                            childEvent[fields_1.recurrenceID] = null;\n                            editParams.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            if (!_this.parent.uiStateValues.isIgnoreOccurrence) {\n                                childEvent[fields_1.recurrenceException] = null;\n                                if (followData_1.occurrence.length > 0) {\n                                    var rule = followData_1.occurrence.slice(-1)[0][fields_1.recurrenceRule];\n                                    if (rule.indexOf('COUNT') === -1) {\n                                        childEvent[fields_1.recurrenceRule] = rule;\n                                    }\n                                }\n                                if (followData_1.follow.length > 0) {\n                                    childEvent[fields_1.recurrenceRule] = followData_1.follow.slice(-1)[0][fields_1.recurrenceRule];\n                                    editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.follow);\n                                }\n                                if (isSpanned) {\n                                    followData_1.occurrence = followData_1.occurrence.filter(function (eventObj) {\n                                        return eventObj[fields_1.recurrenceID] === parentEvent[fields_1.id];\n                                    });\n                                }\n                                editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.occurrence);\n                            }\n                            break;\n                        case 'DeleteFollowingEvents':\n                            _this.processRecurrenceRule(parentEvent, childEvent[fields_1.startTime]);\n                            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.occurrence).concat(followData_1.follow);\n                            break;\n                    }\n                };\n                for (var a = 0, count = followArgs.changedRecords.length; a < count; a++) {\n                    _loop_3(a, count);\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_1.id, _this.getTable(), _this.getQuery());\n                var cloneEvent = extend({}, followArgs.changedRecords[followArgs.changedRecords.length - 1], null, true);\n                _this.parent.eventBase.selectWorkCellByTime(action === 'EditFollowingEvents' ? [_this.parent.eventBase.processTimezone(cloneEvent)] : [cloneEvent]);\n                var crudArgs = {\n                    requestType: action === 'EditFollowingEvents' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: followArgs.changedRecords, promise: promise, editParams: editParams\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processEntireSeries = function (eventData, action) {\n        var _this = this;\n        var seriesData = [];\n        var isDeletedRecords = false;\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_3 = eventData; _i < eventData_3.length; _i++) {\n                var event_7 = eventData_3[_i];\n                seriesData.push(this.getParentEvent(event_7, true));\n            }\n        }\n        else {\n            seriesData = this.getParentEvent(eventData, true);\n        }\n        var updateSeriesEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditSeries' ? 'eventChange' : 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: [], deletedRecords: []\n        };\n        args.data = seriesData;\n        if (action === 'EditSeries') {\n            args.changedRecords = updateSeriesEvents;\n        }\n        else {\n            args.deletedRecords = updateSeriesEvents;\n        }\n        if (action === 'EditSeries' && !this.parent.uiStateValues.isIgnoreOccurrence) {\n            var seriesEvents = seriesData instanceof Array ? seriesData : [seriesData];\n            for (var a = 0, count = args.changedRecords.length; a < count; a++) {\n                var parentEvent = seriesEvents[parseInt(a.toString(), 10)];\n                var eventCollections = this.parent.eventBase.getEventCollections(parentEvent);\n                var deletedEvents = eventCollections.follow.concat(eventCollections.occurrence);\n                args.deletedRecords = args.deletedRecords.concat(deletedEvents);\n            }\n        }\n        this.parent.trigger(events.actionBegin, args, function (seriesArgs) {\n            if (!seriesArgs.cancel) {\n                var fields_2 = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var seriesEvents = seriesData instanceof Array ? seriesData : [seriesData];\n                var records = action === 'EditSeries' ? seriesArgs.changedRecords : seriesArgs.deletedRecords;\n                var _loop_4 = function (a, count) {\n                    var childEvent = records[parseInt(a.toString(), 10)];\n                    var parentEvent = seriesEvents[parseInt(a.toString(), 10)];\n                    var eventCollections = _this.parent.eventBase.getEventCollections(parentEvent);\n                    var deletedEvents = eventCollections.follow.concat(eventCollections.occurrence);\n                    switch (action) {\n                        case 'EditSeries':\n                            childEvent[fields_2.id] = parentEvent[fields_2.id];\n                            childEvent[fields_2.recurrenceID] = null;\n                            childEvent[fields_2.followingID] = null;\n                            if (_this.parent.uiStateValues.isIgnoreOccurrence && childEvent[fields_2.recurrenceException]) {\n                                var originalParent = _this.parent.eventsData.filter(function (eventObj) {\n                                    return eventObj[fields_2.id] === childEvent[fields_2.id];\n                                });\n                                if (originalParent.length > 0) {\n                                    childEvent[fields_2.recurrenceRule] = originalParent[0][fields_2.recurrenceRule];\n                                }\n                            }\n                            else {\n                                childEvent[fields_2.recurrenceException] = null;\n                                editParams.deletedRecords = editParams.deletedRecords.concat(deletedEvents);\n                            }\n                            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            _this.parent.uiStateValues.isIgnoreOccurrence = false;\n                            break;\n                        case 'DeleteSeries':\n                            editParams.deletedRecords = editParams.deletedRecords.concat(deletedEvents.concat(_this.parent.eventBase.processTimezone(parentEvent, true)));\n                            isDeletedRecords = true;\n                            break;\n                    }\n                };\n                for (var a = 0, count = records.length; a < count; a++) {\n                    _loop_4(a, count);\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_2.id, _this.getTable(), _this.getQuery());\n                var cloneEvent = extend({}, records[records.length - 1], null, true);\n                _this.parent.eventBase.selectWorkCellByTime(action === 'EditSeries' ? [_this.parent.eventBase.processTimezone(cloneEvent)] : [cloneEvent]);\n                var crudArgs = {\n                    requestType: action === 'EditSeries' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: isDeletedRecords ? seriesArgs.deletedRecords : seriesArgs.changedRecords,\n                    promise: promise, editParams: editParams\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processDelete = function (eventData) {\n        var _this = this;\n        var deleteData = [];\n        for (var _i = 0, eventData_4 = eventData; _i < eventData_4.length; _i++) {\n            var eventObj = eventData_4[_i];\n            if (eventObj[this.parent.eventFields.recurrenceRule]) {\n                deleteData.push({ occurrence: eventObj, parent: this.getParentEvent(eventObj) });\n            }\n            else {\n                deleteData.push(eventObj);\n            }\n        }\n        var args = {\n            requestType: 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: [], deletedRecords: eventData\n        };\n        args.data = deleteData;\n        this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n            if (!deleteArgs.cancel) {\n                var fields_3 = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var _loop_5 = function (a, count) {\n                    var isDelete = isNullOrUndefined(deleteArgs.deletedRecords[parseInt(a.toString(), 10)][_this.parent.eventFields.recurrenceRule]);\n                    if (!isDelete) {\n                        var parentEvent_1 = deleteData[parseInt(a.toString(), 10)].parent;\n                        var isEdited = editParams.changedRecords.filter(function (obj) {\n                            return obj[fields_3.id] === parentEvent_1[fields_3.id];\n                        });\n                        var editedDate = deleteArgs.deletedRecords[parseInt(a.toString(), 10)][fields_3.startTime];\n                        if (isEdited.length > 0) {\n                            var editedData = isEdited[0];\n                            editedData[fields_3.recurrenceException] =\n                                _this.excludeDateCheck(editedDate, editedData[fields_3.recurrenceException]);\n                        }\n                        else {\n                            parentEvent_1[fields_3.recurrenceException] =\n                                _this.excludeDateCheck(editedDate, parentEvent_1[fields_3.recurrenceException]);\n                        }\n                        if (isEdited.length === 0) {\n                            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent_1, true));\n                        }\n                        isDelete = deleteArgs.deletedRecords[parseInt(a.toString(), 10)][fields_3.id] !== parentEvent_1[fields_3.id];\n                    }\n                    if (isDelete) {\n                        if (deleteArgs.deletedRecords instanceof Array) {\n                            for (var _i = 0, _a = deleteArgs.deletedRecords; _i < _a.length; _i++) {\n                                var event_8 = _a[_i];\n                                _this.parent.eventBase.processTimezone(event_8, true);\n                            }\n                        }\n                        editParams.deletedRecords.push(deleteArgs.deletedRecords[parseInt(a.toString(), 10)]);\n                    }\n                };\n                for (var a = 0, count = deleteArgs.deletedRecords.length; a < count; a++) {\n                    _loop_5(a, count);\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_3.id, _this.getTable(), _this.getQuery());\n                var cloneEvent = extend({}, deleteArgs.deletedRecords[deleteArgs.deletedRecords.length - 1], null, true);\n                _this.parent.eventBase.selectWorkCellByTime([_this.parent.eventBase.processTimezone(cloneEvent)]);\n                var crudArgs = {\n                    requestType: 'eventRemoved', cancel: false, data: deleteArgs.deletedRecords, promise: promise, editParams: editParams\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processSave = function (data) {\n        var _this = this;\n        var eventData = (data instanceof Array) ? data : [data];\n        var editData = [];\n        for (var _i = 0, eventData_5 = eventData; _i < eventData_5.length; _i++) {\n            var eventObj = eventData_5[_i];\n            if (eventObj[this.parent.eventFields.recurrenceRule]) {\n                editData.push({ occurrence: eventObj, parent: this.getParentEvent(eventObj) });\n            }\n            else {\n                editData.push(eventObj);\n            }\n        }\n        var args = { requestType: 'eventChange', cancel: false, addedRecords: [], changedRecords: eventData, deletedRecords: [] };\n        args.data = editData;\n        this.parent.trigger(events.actionBegin, args, function (editArgs) {\n            if (!editArgs.cancel) {\n                var fields = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                for (var _i = 0, _a = editArgs.changedRecords; _i < _a.length; _i++) {\n                    var record = _a[_i];\n                    if (!isNullOrUndefined(record[fields.recurrenceRule]) && isNullOrUndefined(record[fields.recurrenceException])) {\n                        var exceptionString = getRecurrenceStringFromDate(record[fields.startTime]);\n                        var parentEle = _this.getParentEvent(record);\n                        parentEle[fields.recurrenceException] = isNullOrUndefined(parentEle[fields.recurrenceException]) ?\n                            exceptionString : parentEle[fields.recurrenceException].concat(',' + exceptionString);\n                        record[fields.id] = _this.parent.getEventMaxID();\n                        record[fields.recurrenceException] = exceptionString;\n                        editParams.addedRecords.push(_this.parent.eventBase.processTimezone(record, true));\n                        editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEle, true));\n                    }\n                    else {\n                        editParams.changedRecords.push(_this.parent.eventBase.processTimezone(record, true));\n                    }\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n                var cloneEvent = extend({}, editArgs.changedRecords[editArgs.changedRecords.length - 1], null, true);\n                _this.parent.eventBase.selectWorkCellByTime([_this.parent.eventBase.processTimezone(cloneEvent)]);\n                var crudArgs = { requestType: 'eventChanged', cancel: false, data: editArgs.changedRecords, promise: promise, editParams: editParams };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.getParentEvent = function (event, isParent) {\n        if (isParent === void 0) { isParent = false; }\n        var parentEvent = this.parent.eventBase.getParentEvent(event, isParent) || event;\n        if (parentEvent[this.parent.eventFields.startTimezone] || parentEvent[this.parent.eventFields.endTimezone]) {\n            this.parent.eventBase.timezoneConvert(parentEvent);\n        }\n        return parentEvent;\n    };\n    Crud.prototype.excludeDateCheck = function (eventStartTime, exceptionDateList) {\n        var timezone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n        if (timezone) {\n            eventStartTime = this.parent.tzModule.remove(new Date(+eventStartTime.getTime()), timezone);\n        }\n        var exDate = getRecurrenceStringFromDate(eventStartTime);\n        if (!isNullOrUndefined(exceptionDateList)) {\n            if (exceptionDateList.indexOf(exDate) === -1) {\n                exceptionDateList = !(isNullOrUndefined(exceptionDateList)) ? exceptionDateList + ',' + exDate : exDate;\n            }\n        }\n        else {\n            exceptionDateList = exDate;\n        }\n        return exceptionDateList;\n    };\n    Crud.prototype.processRecurrenceRule = function (parentEvent, followEvent) {\n        var fields = this.parent.eventFields;\n        var recurrenceRule = parentEvent[fields.recurrenceRule];\n        var endDate;\n        if (followEvent instanceof Date) {\n            endDate = new Date(+followEvent);\n        }\n        else {\n            endDate = new Date(+followEvent[fields.startTime]);\n            var newRecurrenceRule = followEvent[fields.recurrenceRule];\n            if (newRecurrenceRule) {\n                var startDate = parentEvent[fields.startTime];\n                var ruleException = (this.parent.currentAction === 'DeleteFollowingEvents') ? followEvent[fields.recurrenceException] : null;\n                var dateCollection = generate(startDate, newRecurrenceRule, ruleException, this.parent.activeViewOptions.firstDayOfWeek);\n                var untilDate = new Date(dateCollection.slice(-1)[0]);\n                untilDate.setHours(endDate.getHours(), endDate.getMinutes(), endDate.getSeconds());\n                endDate.setHours(startDate.getHours(), startDate.getMinutes(), startDate.getSeconds());\n                followEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(newRecurrenceRule, new Date(+untilDate), false);\n            }\n        }\n        parentEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(recurrenceRule, util.addDays(new Date(endDate.getTime()), -1), true);\n    };\n    Crud.prototype.getUpdatedRecurrenceRule = function (recurrenceRule, untilDate, isParent) {\n        var splitRule = recurrenceRule.split(';');\n        var updatedRule = '';\n        for (var _i = 0, splitRule_1 = splitRule; _i < splitRule_1.length; _i++) {\n            var rule = splitRule_1[_i];\n            if (rule !== '') {\n                var ruleKey = rule.split('=')[0];\n                var ruleValue = rule.split('=')[1];\n                if (ruleKey === 'COUNT' || ruleKey === 'UNTIL') {\n                    ruleValue = getRecurrenceStringFromDate(untilDate);\n                    rule = rule.replace(rule, 'UNTIL=' + ruleValue);\n                }\n                updatedRule += rule + ';';\n            }\n        }\n        if (isParent && updatedRule.indexOf('UNTIL') === -1) {\n            updatedRule += 'UNTIL=' + getRecurrenceStringFromDate(untilDate);\n        }\n        return updatedRule;\n    };\n    Crud.prototype.isBlockEvent = function (eventData) {\n        var eventCollection = (eventData instanceof Array) ? eventData : [eventData];\n        var value = false;\n        for (var _i = 0, eventCollection_1 = eventCollection; _i < eventCollection_1.length; _i++) {\n            var event_9 = eventCollection_1[_i];\n            value = event_9[this.parent.eventFields.isBlock] || false;\n        }\n        return value;\n    };\n    /**\n     * To destroy the crud module.\n     *\n     * @returns {void}\n     * @private\n     */\n    Crud.prototype.destroy = function () {\n        this.crudObj = null;\n        this.parent = null;\n    };\n    return Crud;\n}());\nexport { Crud };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}